---
title: 索引、高级树结构

date: 2017-06-25 17:13:00

categories:
- 数据结构与算法

tags:
- 算法
- 数据结构

---

## 索引

索引是把一个关键码与它对应的数据记录的位置相关联的过程

索引文件记录了<关键码，指针>对，指针指向了文件的真实地址

### 线性索引

数据库中的记录是不等长的，而且无需存储的。但建立的索引文件是**等长（Key，Point对）、按照关键字有序存储的**，这样可以方便进行二分查找；索引文件的指针指向磁盘文件的地址

![](http://i.imgur.com/1DXYCvu.png)

如果线性索引太大，可以存储在磁盘中。但是一次检索过程中会有多次访问磁盘，从而影响检索的效率，可以使用**二级线性索引**

### 二级线性索引

如果一级索引太大无法直接读入内存，可以存入磁盘中，存在**连续的磁盘块中**。二级线性对磁盘块进行索引

![](http://i.imgur.com/5DF8sRQ.png)

二级线性索引能快速索引到**磁盘块**：

* 二级线性索引的关键码与磁盘块第一条记录的值相等
* 指针指向响应磁盘块的其实位置

![](http://i.imgur.com/OmgLiY6.png)、、

### 倒排索引

对某属性按属性值建立索引；因为不是由记录关键码来确定属性值，而是由属性值来确定记录的位置，因此成为倒排索引

这些属性往往是**离散型**的，对于连续型的用B树

举个例子，假设EMP是主键，其余的是属性。如果不建立属性倒排索引，如果需要查找属性为某个值的记录，那么需要从头开始读取记录，判断每条记录的属性是否是查询的值，非常耗时

![](http://i.imgur.com/cCjGMrk.png)

倒排文件的索引项是（key，point[]）：

* 一个具体的索引值
* 一组指针（因为属性值不是唯一的，一个属性会对应多条记录）

对上述记录建立的倒排文件如下，可以根据属性获得主键ID，然后再通过主键查询记录

![](http://i.imgur.com/7Ty52wU.png)

### 正文索引

对文本内容进行快速检索

* 词索引：从正文中抽出关键词，对关键词进行快速索引
* 全文索引：把正文看做一个长的字符串，对每一个字符建立索引，使查找不再限于关键词，需要更大的空间

建立正文倒排索引步骤：

1、把正文分成多条记录
2、每条记录赋予一个关键词
3、建立正文倒排文件

倒排文件的索引结构：

![](http://i.imgur.com/Ib1kiRz.png)

## 高级树结构

### Trie树

Trie来源于retrieval，即检索

基于关键码分解的数据结构，常应用于信息检索、存储英文字符串

下面展示的Trie结构的树，**人为指定左右节点的范围**，使树的分布相对均匀；如在根节点，将小于32的树放在左子树，大于32的树放入右子树

![](http://i.imgur.com/BGjZxHO.png)

### 英文字符树

按照英文字幕的索引建立索引，即前缀树

![](http://i.imgur.com/VPBvjz0.png)

对于不等长的字符串，比如规定字符串的长度是3，那么对于字符串an，可以转换成an\*；检索时检索到\*表示检索结束

![](http://i.imgur.com/4kUY7zI.png)

### 平衡的二叉搜索树（AVL）

平衡的二叉搜索树定义：左右节点的高度小于等于1

**插入节点后，根节点的变化大致有三类：**

* 原来节点时平衡的，现在成为左重或右重的
* 节点原来是某一边重，而现在成为平衡的了
* 节点原来是左重或右重的，又加到重的一边，**现在不平衡了**，需要进行调整！！！

**举个例子：**

如下图，插入17前是平衡树，节点2的平衡因子是+1，即右子树比左子树高度大1；节点15是平衡的；
插入17后，节点2的平衡因子变成2，节点1的平衡因子变成1，失衡了，**需要调整节点2，节点15，节点7之间的关系**

很简单，用中间值15作为根节点，12小于15作为左节点，17大于15作为右节点，调整后如下：

![](http://i.imgur.com/zBKQlJG.png)

<font color='red'>可以发现，调整之前，节点2的高度是2，调整之后，节点2的高度还是2，没有变化，所以不影响其他节点</font>

**插入节点时平衡因子变化**

* 不平衡的情况发生在插入新节点后
* **BST把新节点插入到叶结点**★★★（根节点与叶节点交换，然后插入）
* 假设a是离插入节点最近，且平衡因子绝对值不等于0的节点（如果节点的平衡因子等于0不需要调整结构）
	* 插入的关键码要么在它的左子树中，要么在其右子树中
	* **假设插入在右边**，此时a的平衡因子有三种情况：-1，0，1，如下图

![](http://i.imgur.com/4alZl20.png)

1、原来a的平衡因子是-1，即左子树的高度比右子树的高度大1。右边插入节点后，平衡因子变成0，左右子树高度相等，变平衡了
2、原来a的平衡因子是0，左右子树高度相等。右边插入节点后，右子树的高度比左子树高度大1，平衡因子变为1
3、左图a的平衡因子变成2，b的平衡因子为1，<font color='red'>需要调整</font>；右图a的平衡因子变成，b的平衡因子编程-1，<font color='red'>需要调整</font>；

**不平衡的情况总结★★★★**

![](http://i.imgur.com/tfK5H9S.png)

分为四种：LL，LR，RL，RR，其中LL和RR比较相似，LR和RL相似

**LL**

如下图有一颗平衡树，其中T1、T2、T3都表示子树，他们的高度都是h。那么节点B的平衡因子是0，节点A的平衡因子是-1，中序遍历的结果是：T1、B、T2、A、T3

此时如果在A的左子树中插入一个节点，会造成节点A的平衡因子变成-2，造成树不平衡

![](http://i.imgur.com/h9NsaHS.jpg)

LL主要节点是A、B、T1，三者的大小关系是T1<B<A， B为A和T1的分割节点，调整时保持B不变，将A右旋

**先确定T、B、A的位置，T1和A各自的子节点保持不变；在A右旋的时候，替换了B的右节点，所以将B的有节点T2挂载挂在A的左节点上**

![](http://i.imgur.com/zVVdLOn.jpg)

调整后中序遍历结果没有变化，树保持平衡

![](http://i.imgur.com/I6vDXgv.jpg)

**RL**

![](http://i.imgur.com/vckMLrR.jpg)

![](http://i.imgur.com/7WY6ERj.jpg)

![](http://i.imgur.com/ivnDQpp.jpg)

![](http://i.imgur.com/1TST6pV.jpg)