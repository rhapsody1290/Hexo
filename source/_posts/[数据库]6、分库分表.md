---
title: 6、分库分表

date: 2017-10-19 15:02:00

categories:
- 数据库

tags:
- 数据库

---

## 背景

1、随着用户数量的增加，user表的数据量会越来越大，当数据量达到一定程度的时候对user表的查询会渐渐的变慢，从而影响整个DB的性能

2、当并发量特别大时，数据库负载很大

3、如果使用mysql, 还有一个更严重的问题是，当需要添加一列的时候，mysql会锁表，期间所有的读写操作只能等待。 

## 分库分表规则

4个库，16章相同的表

根据用户id，取余的方式决定将记录保存到哪个库、哪个表

## 分库分表维度的问题 

假如用户购买了商品,需要将交易记录保存取来，如果按照用户的纬度分表，则每个用户的交易记录都保存在同一表中，所以很快很方便的查找到某用户的购买情况，但是某商品被购买的情况则很有可能分布在多张表中，查找起来比较麻烦。
反之，按照商品维度分表，可以很方便的查找到此商品的购买情况，但要查找到买人的交易记录比较麻烦。

所以常见的解决方式有： 

a.通过扫表的方式解决，此方法基本不可能，效率太低了。 

**b.记录两份数据，一份按照用户纬度分表，一份按照商品维度分表。**

**c.通过搜索引擎解决，但如果实时性要求很高，又得关系到实时搜索。**

## 联合查询的问题 

联合查询基本不可能，因为关联的表有可能不在同一数据库中。 

## 避免跨库事务 

避免在一个事务中修改db0中的表的时候同时修改db1中的表，一个是操作起来更复杂，效率也会有一定影响。 

## 尽量把同一组数据放到同一DB服务器上 

例如将卖家a的商品和交易信息都放到db0中，当db1挂了的时候，卖家a相关的东西可以正常使用。也就是说避免数据库中的数据依赖另一数据库中的数据。 
