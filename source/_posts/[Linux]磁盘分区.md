---
title: 磁盘分区

date: 2016-08-01 00:00:00

categories:
- Linux

tags:
- Liunx
- 鸟哥的Linux私房菜
- 磁盘分区

---
## 磁盘连接方式与设备文件名的关系

* 计算机常用的磁盘接口有两种，分别是IDE与SATA接口，目前主流是SATA接口
* 一个IDE电缆可以连接两个IDE设备，通常主机提供两个IDE接口，因此最多可以接四个IDE设备。IDE设备分为主设备（Master）与从设备（Slave），四个IDE设备的文件名分别是**/dev/hda、/dev/hdb、/dev/hdc/、/dev/hdd**，对应IDE1的主设备、IDE1的从设备、IDE2的主设备、IDE2的从设备
* SATA/USB/SCSI接口的磁盘设备文件名都是**/dev/sd[a-p]**，与IDE接口不同的是，SATA/USB接口没有一定的顺序，根据**Linux内核检测到的磁盘顺序决定**，即设备文件名与插槽号无关，Linux内核根据SATA插槽顺序进行检测磁盘，USB在开机候才被系统识别
![](http://i.imgur.com/WXsDx1n.jpg)

## 磁盘组成

* 磁盘由盘片、机械手臂、磁头与主轴马达组成，数据的写入是在盘片上
* 盘片上可以细分为扇区与柱面两种单位
* 磁道：盘片表面上以盘片中心为圆心，不同半径的同心圆称为磁道
* 柱面：硬盘中，不同盘片相同半径的磁道所组成的圆柱称为柱面。磁道与柱面都是表示不同半径的圆，在许多场合，磁道和柱面可以互换使用
* 扇区：磁盘上的每个磁道被等分为若干个弧段，这些弧段便是磁盘的扇区，每个扇区可以存放512个字节的信息，磁盘驱动器在向磁盘读取和写入数据时，要以扇区为单位

![](http://img.mydigit.net/Mon_1111/84_493179_8d87dfa7e9d372c.jpg?26)


***问题1：不同磁道的扇区数是否相同？***
* **在旧的记录方式**，的确每个磁道所拥有的扇区数量都是一样的。因为每个扇区所能容纳的数据量是相同的，都是512字节，而数据量需要平均分配在扇区面积的每个角落，所以外面扇区的数据密度低，里面扇区的速度密度高
![](http://i.imgur.com/zHHLPEj.png)

* **新的解决方式**认为，既然磁盘越往外面积越大，那就应该划分出更多的扇区，每个扇区的面积都是一样的，容纳的数据量也是一样的
![](http://i.imgur.com/0kRy8Wz.png)

***问题2：如果有一块空硬盘，写入一个文件，是不是先写满同一个磁道的所有扇区，然后再换一个磁道写入？***

　　是的，而且**写入的方式是从外到内**，先写满最外的磁道，接着再写里面的磁道。为什么硬盘用久了读写速度会变慢？因为外面的磁道使用完了，开始用里面的磁道，越是里面的磁道读写速度越慢，同样的时间，读写头在外面磁道可以扫过10个扇区的面积，读写10个扇区的数据，但在里面的磁道只能扫过1个扇区的面积，读写1个扇区的数据，所以这时该做磁盘整理或者格式化，这会使外面的磁道得到使用

## 磁盘的第一扇区（主引导分区、分区表）

磁盘的第一个扇区记录了两个重要信息，分别是：

* 主引导分区（MBR），可以安装引导加载程序的地方，有446bytes。MBR是很重要的，系统在**开机的时候会主动去读取这个区块的内容，这样系统才知道你的程序放在哪里且如何进行开机。**如果你要安装多重引导的系统，MBR这个区块的管理就非常重要了
* 分区表，记录整块硬盘分区的状态，有64bytes 

## 磁盘分区表

![](http://i.imgur.com/Y8b8nPX.png)

* 柱面是分割磁盘的最小单位，以开始柱面与结束柱面来标识一个分区
* 假设上面硬盘的设备文件名为/dev/hda，四个分区的设备文件名会在文件名后再加上一个数字，分别是/dev/hda1，/dev/hda2，/dev/hda3，/dev/hda4
* 上述硬盘被分为四个分区，第四个分区为301~400柱面的范围，在windows系统中，四个分区分别是C、D、E、F。当你把数据写入F盘时，你的数据会被写入这块磁盘的301~400号柱面之间
* **分区表总结**

	* **所谓的分区就是对64bytes的分区表进行设置而已**
	* 分区的最小单位是柱面
	* **分区表默认只能写入四组分区信息，即主分区与扩展分区不超过四个**
	* 系统要写入磁盘时，必须参考分区表，才能对某个分区进行数据处理
	* 分区的好处：数据安全，系统性能

![](http://i.imgur.com/U8YbelW.png)

* 分区继续深入

	* 上图中四个分区记录区仅用到两个，P1为主分区，P2为扩展分区
	* 图中这5个由扩展分区切出来的分区叫做逻辑分区
	* 上述分区在Linux下的设备文件名分别是P1：hda1，P2：hda2，L1：hda5，L2：hda6，L3：hda7，L4：hda8，L5：hda9
	* **发现少了hda3，hda4，因为前面四个号码都是保留给主分区和扩展分区用的，所以逻辑分区的设备号从5开始**

* **分区总结**
	
	* 主分区和扩展分区最多有四个
	* 扩展分区最多只有一个（操作系统的限制）
	* 逻辑分区是由扩展分区切割出来的分区
	* 能够被格式化的是主分区和逻辑分区，扩展分区无法格式化 

## MBR（Master boot Record）主引导分区

### 开机流程

* 操作系统的作用是控制计算机硬件资源的合理分配，但操作系统也是一个软件，从开机到执行操作系统软件的过程如下：
* CMOS是记录各项硬件参数且嵌在主板上的存储器，BIOS是写入到主板的一个软件程序，**是计算机开机主动执行的第一个的程序**
* ***BIOS*** 会根据用户的设置取得能够开机的硬盘，并读取该硬盘第一个扇区的 ***MBR*** 位置，MBR中会放置 <font color='red'>***引导加载程序***</font>，引导加载程序的目的是加载内核文件，***内核文件*** 开始操作系统的功能

### 多系统

* 引导加载程序的主要功能是读取内核文件，开始操作系统。在多系统中，引导加载程序能提供用户不同的开机选项，并将加载功能转交给其他引导加载程序
* 引导加载程序不但可以放置在MBR中，还可以安装在每个分区的引导扇区
* 如下图是windows和Linux双系统，开机时MBR的引导加载程序提供两个菜单，菜单一（M1）可以直接加载Windows内核文件来开机，菜单二（M2）则将引导加载工作移交给第二个分区的引导加载程序，加载Linux的内核文件来开机
![](http://i.imgur.com/XFSpuWG.png)

***为什么装双系统，最好先装windows再装Linux？***

* 因为Linux在安装时，可以选择将<font color='red' > ***引导加载加载程序*** </font>安装在MBR还是个别分区的引导扇区
* Windows安装时，它的安装程序会主动覆盖掉MBR以及自己所在分区的启动扇区